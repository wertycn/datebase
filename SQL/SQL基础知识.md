# SQL语言笔记
## 1. 数据库语言概述

SQL(Structured Query Language)  1974年由Boyce和Chamberlin提出，是在关系数据库中使用最普便的语言。

数据定义语言 DDL

数据操作语言 DML
## 2. SQL概述

SQL标准：ANSI SQL , SQL-92 , SQL-99

SQL 特点：综合统一、 高度非过程化、面向集合的操作方式、两种使用方式（自含式、嵌入式）、语言简洁、易学易用
### SQL核心功能动词

* 数据查询 SELECT 

* 数据定义 CREATE  DROP  ALTER 

* 数据操纵 INSERT  UPDATE  DELETE 

* 数据控制 GRANT  REVORK 

### SQL支持三级模式结构
View 视图 对应  外模式
Base Table 基本表 对应 模式
Sored File 存储文件 对应 内模式

### SQL基本组成
1. 数据定义语言 DDL
     提供定义关系模式和视图、删除关系和视图、修改关系模式的命令
2. 交互式数据操纵语言 DML 
    提供查询、插入、修改和删除的命令
3. 事务控制
     提供定义事务开始和结束的命令
4. 嵌入式SQL 和 动态 SQL
     
5. 完整性约束
    定义数据库中的数据必须符合完整性约束，破坏完整性的更新将被禁止
6. 权限管理
    说明对关系和视图的访问权限
## 4. 数据库定义

### SQL数据类型

| 类型 | 说明|
| ------ | ----- |
| char(n) | 固定长度字符串,表示n个字符的固定长度的字符串|
| varchar(n) | 可变长度字符串，表示最多可以有n个字符的字符串|
| int | 整型|
| smallint | 短整型 |
| numeric(p,d) | 定点数p为整数位，n为小数位 |
| real | 浮点型 |
| double precision | 双精度浮点型 |
| float(n) | n为浮点型 | 
| boolean | 布尔型 | 
| date | 日期型 |
| time | 时间型 |
### 创建表
语句格式:
```
CREATE TABLE <表名> (<列名><数据类型>[列级完整性约束条件]
                    [,<列名><数据类型>[列级完整性约束条件]] ···
                    [,<表级完整性约束条件>]);
```
列级完整性约束条件有 `NULL`（空）和 `UNIQUE` (取值唯一)
表级完整性约束条件主要有 `PRIMARY KEY(<列名>)` (主键定义)
和 `FOREIGN KEY(<列名>) REFERENCES <表名>(<列名>)` （外键定义）
当定义主键时，主键列的 `NOT NULL UNIQUE`  列级完整性约束可以省略 
### 修改表
语句格式：
```
ALTER TABLE <表名> 
  [ADD <新列名><数据类型>[列级完整性约束条件]]   # 新增列
  [DROP <完整性约束名>]                        # 删除列
  [MODIFY <列名><数据类型>]                    # 修改列的类型
```
### 删除表
语句格式：
```
DROP TABLE <表名>
```

### 创建索引
* 索引的作用：
  数据库的索引类似书籍中的目录，利用索引在查询数据时无需扫描全表，就可以找到需要的信息。数据库的索引是表中一列或者若干列的集合和相应的指向表中物理标识这些值的数据页的逻辑指针清单
  索引通过事先排序，在查找时可以应用2分法等高效算法缩短查询时间
  1. 通过创建唯一索引，可以保证数据记录的唯一性
  2. 大大加快数据检索速度
  3. 加速表与表之间的连接，在实现数据参照完整性中非常有意义
  4. 在使用` GROUP BY ` 和 ` ORDER BY `子句进行检索数据时，可以显著减少查询中分组和排序的时间
  5. 使用索引可以在检索数据的过程中使用优化隐藏器，提高系统性能
* 语句格式：
```
CREATE [UNIQUE][CLUSTER] INDEX <索引名> 
  ON <表名>(<列名>[<次序>][,<列名>[<次序>]]···)
```
  参数说明：
  * 次序 ：可选 ASC (升序)或DSC(降序) ，默认值为ASC
  * UNIQUE : 表明此索引是唯一索引，即每个索引值只对应唯一一条数据记录
  * CLUSTER : 表明要建立的索引是聚簇索引，表中索引项的顺序与物理记录的顺序一致。
### 删除索引
语句格式：
```
DROP INDEX <索引名>
```
### 视图
#### 视图的作用
视图是从一个或多个基本表中导出的表，其结构和数据是建立在对表的查询基础上，和真实的表一样，视图也包括几个被定义的数据列和多个数据行，单本质上，这些数据均来自与其所引用的表，因此，视图不是真实存在的基本表，而是一个虚拟表。使用视图有以下优点和作用：
  1. 可以使视图集中数据，简化和定制不同用户对数据库的不同数据要求
  2. 可以屏蔽数据复杂性，用户不必了解数据库的结构，就可以方便的使用和管理数据，简化数据权限管理和重新组织数据以便输出到其他应用程序中。
  3. 视图可以使用户只关心他感兴趣的某些特定数据和他们所负责的特定任务，那些无用或不需要的数据则不在视图中显示
  4. 视图大大简化了用户对数据的操作
  5. 视图可以让不同用户以不同的方式看到不同或相同的数据
  6. 在某些情况下，由于表中的数据量太大，因此在表的设计中时常将表进行水平或者垂直分割，但表的结构的变化会对应用程序产生不良的影响，视图可以屏蔽这种不良影响
  7. 视图提供了一个简单而有效的安全机制
 #### 视图创建
语句格式：
```
CREATE VIEW <视图名>(<列表名>)
    AS SELECT <查询子句>
    [WITH CHECK OPTION];
```
注意：
  1. 查询子句可以是任意复杂的SELECT 子句，但是通常不允许有`ORDER BY` 和   `DISTINCT` 短语
  2. `WITH CHECK OPTION` 表示对视图进行`UPDATE INSTER DELETE`操作时保证操作行满足视图定义中的条件表达式
  3. 组成视图的属性列名或者全部指定，或者全部省略，如果省略属性列名，则隐含该视图，由SELECT子查询目标列的主属性组成
#### 视图的删除
语句格式：
```
DROP VIEW <视图名>
```
## 5. 数据操作
SQL的数据操作功能包括查询`SELECT`、插入`INSTER`、删除`DELETE`和修改`UPDATE`四条语句
### SELECT 基本结构
语句格式：
```
SELECT  [ALL|DISTINCT] <目标列表达式>[,<目标列表达式>]···
FROM <表名或视图名>[,<表名或视图名>]···
[ WHERE  <条件表达式> ]
[ GROUP BY <列名1> [HAVING<条件表达式>] ]
[ ORDER BY <列名2> [ASC|DESC] ··· ]
```
说明：
    SQL查询中子句顺序为`SELECT` , `FROM` , `WHERE` , `GROUP BY` , `HAVING` 和 `ORDER BY`。其中，`SELECT` 和 `FROM` 是必需的，`HAVING`必须搭配`GROUP BY`子句使用    
| SQ查询子句  | 对应关系代数运算 |
| ---------|------------|
| `SELECT` | 投影 |
| `FROM`    | 笛卡尔积 | 
| `WHERE` | 关系谓词 | 

**WHERE 子句中的条件表达式中可以使用的运算符**    
| 运算符 |   | 含义 |
|----------|----|-------|
| 集合成员运算符 |  IN | 在集合中 |
| 集合成员运算符 | NOT IN | 不在集合中 |
| 字符串匹配运算符 | LIKE | 与_%进行单个、多个字符的匹配 |
| 空值比较运算符 | IS NULL | 是否为空 |
| 空值比较运算符 | IS NOT NULL | 是否不为空 |
| 算术运算符        |  > ，>= ， < ， <= ，=  ，!=  | 大于，大于等于，小于，小于等于 ，等于，不等于 |
| 逻辑运算符 | AND | 与 |
|                |OR | 或 |
|                |NOT | 非 | 

### 简单查询 
找出关系中满足特定条件的元组
语句形式：
```
  SELECT <字段名1>,<字段名2> ，····
      FROM <表名>
      WHERE <条件表达式>
```
### 连接查询
涉及两个或两个以上表查询，称为连接查询
语句形式：
```
SELECT <a表属性1>,<b表属性2> ····
    FROM <a表>,<b表>
    WHERE <连接条件>  AND <连接后筛选条件>
```
### 子查询
子查询也称嵌套查询，嵌套查询是指`SELECT - FROM - WHERE` 查询块可以嵌入另一个查询块中
例1 结果作为子查询：
```
SELECT <字段名1>,<字段名2> 
    FROM <表名1>
    WHERE <字段名3> in (
        SELECT <表2字段1> FROM <表名2> WHERE <条件表达式>
    )
```
例2 结果作为临时表：
```
SELECT <字段名1>,<字段名2>  
    FROM  (
          SELECT <字段名1>,<字段名2>,<字段名3>
          FROM <表名>
          WHERE <条件表达式>
    ) AS a
    WHERE <条件表达式>
```
 ### 聚集函数
一个集合为输入，返回单个值得函数称为聚集函数。SQL提供5个预定义得集函数：平均值AVG，最小值MIN ，最大值 MAX ，求和 SUM 以及计数 COUNT   

**集函数的功能**  

| 集函数名 | 功能 |
| ------------- | -------| 
|COUNT([DISTINCT\|ALL] *) | 统计元组个数 |
|COUNT([DISTINCT\|ALL] <列名>) | 统计一列中值的个数 |
|SUM([DISTINCT\|ALL] <列名>)| 计算一列中值的总和，列需为数值列 |


-------------------------
未完待续









